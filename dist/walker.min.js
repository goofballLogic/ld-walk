"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var e=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e,t){e.exports=function(){function e(){}return e.prototype.encodeReserved=function(e){return e.split(/(%[0-9A-Fa-f]{2})/g).map((function(e){return/%[0-9A-Fa-f]/.test(e)||(e=encodeURI(e).replace(/%5B/g,"[").replace(/%5D/g,"]")),e})).join("")},e.prototype.encodeUnreserved=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}))},e.prototype.encodeValue=function(e,t,n){return t="+"===e||"#"===e?this.encodeReserved(t):this.encodeUnreserved(t),n?this.encodeUnreserved(n)+"="+t:t},e.prototype.isDefined=function(e){return null!=e},e.prototype.isKeyOperator=function(e){return";"===e||"&"===e||"?"===e},e.prototype.getValues=function(e,t,n,r){var o=e[n],i=[];if(this.isDefined(o)&&""!==o)if("string"==typeof o||"number"==typeof o||"boolean"==typeof o)o=o.toString(),r&&"*"!==r&&(o=o.substring(0,parseInt(r,10))),i.push(this.encodeValue(t,o,this.isKeyOperator(t)?n:null));else if("*"===r)Array.isArray(o)?o.filter(this.isDefined).forEach((function(e){i.push(this.encodeValue(t,e,this.isKeyOperator(t)?n:null))}),this):Object.keys(o).forEach((function(e){this.isDefined(o[e])&&i.push(this.encodeValue(t,o[e],e))}),this);else{var s=[];Array.isArray(o)?o.filter(this.isDefined).forEach((function(e){s.push(this.encodeValue(t,e))}),this):Object.keys(o).forEach((function(e){this.isDefined(o[e])&&(s.push(this.encodeUnreserved(e)),s.push(this.encodeValue(t,o[e].toString())))}),this),this.isKeyOperator(t)?i.push(this.encodeUnreserved(n)+"="+s.join(",")):0!==s.length&&i.push(s.join(","))}else";"===t?this.isDefined(o)&&i.push(this.encodeUnreserved(n)):""!==o||"&"!==t&&"?"!==t?""===o&&i.push(""):i.push(this.encodeUnreserved(n)+"=");return i},e.prototype.parse=function(e){var t=this,n=["+","#",".","/",";","?","&"];return{expand:function(r){return e.replace(/\{([^\{\}]+)\}|([^\{\}]+)/g,(function(e,o,i){if(o){var s=null,a=[];if(-1!==n.indexOf(o.charAt(0))&&(s=o.charAt(0),o=o.substr(1)),o.split(/,/g).forEach((function(e){var n=/([^:\*]*)(?::(\d+)|(\*))?/.exec(e);a.push.apply(a,t.getValues(r,s,n[1],n[2]||n[3]))})),s&&"+"!==s){var u=",";return"?"===s?u="&":"#"!==s&&(u=s),(0!==a.length?s:"")+a.join(u)}return a.join(",")}return t.encodeReserved(i)}))}}},new e}()}));const t={walk(t,n={}){const r=n.jsonld,o=n["ld-query"];return{pathContext:t,from:function(e,t){return{pathContext:e,walkFrom:t,to:(n,r)=>a({...r,pathContext:e,walkFrom:t,walkTo:n})}}.bind(this,t)};function i(e){return o(e,{})}async function s(e){try{return i(await r.expand(e))}catch(e){if(e.details&&"loading document failed"==e.details.code)return null;throw e}}async function a({pathContext:e,walkFrom:t,walkTo:n,lastFetched:r,query:l,suppressFinalDereferencing:p}){Array.isArray(n)||(n=(n||"").split(" "));const d=await c(e,n);r||(l=await s(t),r=t);let f,h,y=0;for(;l&&l.query&&d.length;){const t=d.shift();let n;if(y++,h=l,"term"in t){const e=`> ${t.term}`;if(n=l.query(e),!n){const t=l.query("> @id");if(t){r=t;const o=await s(t);n=o&&o.query(e)}}}else if("id"in t){const e=t.id;n=await m(e)}else if("query"in t){const r=o(l.json(),e).query(t.query),s=r&&r.parent();n=s&&i(s.json())}else{if(!("template"in t))throw new Error("Unhandled step: "+JSON.stringify(t));{const r=t.template,[o,i]=r.split(",").map(e=>e&&e.trim());try{const t=await u(o,i,{pathContext:e,query:l});n=t&&await m(t)}catch(e){f=e,n=void 0}}}l=n}if(!p&&l&&l.query){const e=l.query("> @id");e&&e!==r&&(l=await s(e)||l)}const w=!!l,g={walked:n.slice(0,y),toQuery:e=>l&&o(l.json(),e||{}),continueTo:(t,n)=>w?a({...n,pathContext:e,walkTo:t,lastFetched:r,query:l}):g,succeeded:w,viaTemplate:(t,n)=>w?async function(e,t,n){try{const r=await u(e,t,n);return a({...n,walkTo:[`id[${r}]`]})}catch(e){const t=n&&n.query;return{succeeded:!1,err:{message:e.message,json:t?t.json():null}}}}(t,n,{pathContext:e,lastFetched:r,query:l}):g};return f&&(g.err={message:f.message,json:h?h.json():null}),g.succeeded||(g.notWalked=n.slice(y)),g;async function m(e){let t=l.query(`[@id=${e}]`);return t||(r=e,t=await s(e)),t}}async function u(t,n,{pathContext:r,query:o}){if(!o)throw new Error("No query object during template expansion");if(!t)throw new Error("No template path specified");"string"==typeof n&&(n=JSON.parse(n));const i=await c(r,[t]);if(!i[0]||!i[0].term)throw new Error("Aborting - template path expansion failed (e.g. resulted in an empty string)");const s=i[0].term;let a=o.query(`> ${s}`);if(!a)throw new Error(`Failed to locate template ${s}`);if(a.query&&(a=a.query("@value")),!a)throw new Error("Template property has no value to expand");return e.parse(a).expand(n)}async function c(e,t){const n={"@context":[e,{"http://__ldwalk/term":{"@type":"@vocab"}}],"@graph":t.map((function(e){const t=function(e){if(!e)return;const t=/^([^\[]+)\[(.*)\]$/.exec(e);return t?{[`http://__ldwalk/${t[1]}`]:t[2]}:void 0}(e);return t||{"http://__ldwalk/term":e}}))},o=await r.expand(n),i=o.length>1,s=await r.compact(o,{"@context":{"@vocab":"http://__ldwalk/",term:{"@id":"http://__ldwalk/term","@type":"@id"}}});return i?s["@graph"]:(delete s["@context"],[s])}}};export default t;
//# sourceMappingURL=walker.min.js.map
